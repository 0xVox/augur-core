from ethereum import tester as t
t.gas_limit = 100000000
s = t.state()
c = s.abi_contract('src/consensus/test.se')

z = c.makeEvent()
n = c.getReporterID(1010101,0)
c.setReporterBallot(1010101,0,n,[2*2**64], 47*2**64)
c.getReporterBallot(1010101, 0, n)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
o = c.getOutcome(z)
if(o==2*2**64):
	print('all good')
else:
	print('bad outcome')

s = t.state()
c = s.abi_contract('src/consensus/test.se')
z = c.makeEvent()
a = c.createEvent(1010101, "hehe", 1, 1, 2, 2, 1)
e = c.createEvent(1010101, "lawl", 1, 1, 2, 2, 1)
n = c.getReporterID(1010101,0)
c.setReporterBallot(1010101,0,n,[2**64, 2*2**64, 2**64], 47*2**64)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
o = c.getOutcome(z)
n = c.getOutcome(a)
z = c.getOutcome(e)
if(o==2**64):
	print('all good')
else:
	print('bad outcome')

s = t.state()
c = s.abi_contract('src/consensus/test.se')
z = c.makeEvent()
n = c.getReporterID(1010101,0)
a = c.createEvent(1010101, "hehe", 1, 1, 2, 2, 1)
e = c.createEvent(1010101, "lawl", 1, 1, 2, 2, 1)
c.addReporter(1010101, 4242)
c.addReporter(1010101, 112)
c.setRep(1010101, 1, 47*2**64)
c.setRep(1010101, 2, 47*2**64)
c.setReporterBallot(1010101,0,n,[2**64, 2*2**64, 2**64], 47*2**64)
c.setReporterBallot(1010101,0,112,[2**64, 2*2**64, 2**64], 47*2**64)
c.setReporterBallot(1010101,0,4242,[2**64, 2*2**64, 2**64], 47*2**64)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
o = c.getOutcome(z)
n = c.getOutcome(a)
z = c.getOutcome(e)

s = t.state()
c = s.abi_contract('src/consensus/test.se')
z = c.makeEvent()
n = c.getReporterID(1010101,0)
a = c.createEvent(1010101, "hehe", 1, 1, 2, 2, 1)
e = c.createEvent(1010101, "lawl", 1, 1, 2, 2, 1)
c.addReporter(1010101, 4242)
c.addReporter(1010101, 112)
c.setRep(1010101, 1, 47*2**64)
c.setRep(1010101, 2, 47*2**64)
c.setReporterBallot(1010101,0,n,[2**64, 2*2**64, 2**64], 47*2**64)
c.setReporterBallot(1010101,0,112,[2**64, 1*2**64, 2**64], 47*2**64)
c.setReporterBallot(1010101,0,4242,[2**64, 2*2**64, 2**64], 47*2**64)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
o = c.getOutcome(z)
n = c.getOutcome(a)
z = c.getOutcome(e)

unequal rep
s = t.state()
c = s.abi_contract('src/consensus/test.se')
z = c.makeEvent()
n = c.getReporterID(1010101,0)
a = c.createEvent(1010101, "hehe", 1, 1, 2, 2, 1)
e = c.createEvent(1010101, "lawl", 1, 1, 2, 2, 1)
c.addReporter(1010101, 4242)
c.addReporter(1010101, 112)
c.setRep(1010101, 1, 47*2**64)
c.setRep(1010101, 2, 147*2**64)
c.setReporterBallot(1010101,0,n,[2**64, 2*2**64, 2**64], 47*2**64)
c.setReporterBallot(1010101,0,112,[2**64, 1*2**64, 2**64], 47*2**64)
c.setReporterBallot(1010101,0,4242,[2**64, 2*2**64, 2**64], 47*2**64)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
o = c.getOutcome(z)
n = c.getOutcome(a)
z = c.getOutcome(e)

# test scalars and categoricals
s = t.state()
c = s.abi_contract('src/consensus/test.se')
z = c.makeEvent()
n = c.getReporterID(1010101,0)
# 0 - 250 scalar
a = c.createEvent(1010101, "hehe", 1, 0, 250, 2, 1)
# 9 outcome categorical
e = c.createEvent(1010101, "lawl", 1, 0, 8, 9, 1)
c.addReporter(1010101, 4242)
c.addReporter(1010101, 112)
c.setRep(1010101, 1, 47*2**64)
c.setRep(1010101, 2, 47*2**64)
c.setReporterBallot(1010101,0,n,[2**64, 9370945989444452352, 6917529027641081856], 47*2**64)
c.setReporterBallot(1010101,0,112,[2**64, 9370945989444452352, 6917529027641081856], 47*2**64)
c.setReporterBallot(1010101,0,4242,[2**64, 9370945989444452352, 6917529027641081856], 47*2**64)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
c.dispatch(1010101)
o = c.getOutcome(z)
n = c.getOutcome(a)
z = c.getOutcome(e)
<!doctype html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html lang="en" data-useragent="Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)">
<head>
    <title>Augur</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
        <!--//-->
    <script src="static/bignumber.js"></script>
    <script src="static/es6-promise.js"></script>
    <script src="static/ethereum.js"></script>
    <script type="text/javascript">
        var web3 = require('web3');
        var ethsocket = "ws://127.0.0.1:40404/eth";

        web3.setProvider(new web3.providers.WebSocketProvider(ethsocket));

        // test websocket connection
        web3.sha3(web3.fromAscii("hello world"));

        // solidity source code
        var source = "" + 
        "contract test {\n" +
        "   function multiply(uint a) returns(uint d) {\n" +
        "       return a * 7;\n" +
        "   }\n" +
        "}\n";

        // contract description, this will be autogenerated somehow
        var desc =  [{
            "name": "multiply",
            "inputs": [{
                "name": "a",
                "type": "uint256"
            }],
            "outputs": [{
                "name": "d",
                "type": "uint256"
            }]
        }];

        var contract;

        function createExampleContract() {
            // hide create button
            document.getElementById('create').style.visibility = 'hidden'; 
            document.getElementById('source').innerText = source;
            // create contract
            web3.eth.transact({code: web3.eth.solidity(source)}).then(function (address) {
                contract = web3.contract(address, desc);
                document.getElementById('call').style.visibility = 'visible';
            });
        }

        function callExampleContract() {
            // this should be generated by ethereum
            var param = parseInt(document.getElementById('value').value);
            // call the contract
            contract.multiply(param).call().then(function(res) {
                document.getElementById('result').innerText = res[0];
            });
        }
    </script>
</head>
<body>
    <h1>contract</h1>
    <div id="source"></div> 
    <div id='create'>
        <button type="button" onClick="createExampleContract();">create example contract</button>
    </div>
    <div id='call' style='visibility: hidden;'>
        <input type="number" id="value" onkeyup='callExampleContract()'></input>
    </div>
    <div id="result"></div>
</body>
</html>
